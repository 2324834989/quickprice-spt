# QuickPrice 打包发布流程

## 📋 目录结构

发布包应包含以下文件结构：

```
QuickPrice-v{版本号}/
├── README.txt
├── BepInEx/
│   └── plugins/
│       └── QuickPrice/
│           └── QuickPrice.dll          (客户端插件)
└── SPT/
    └── user/
        └── mods/
            └── QuickPrice/
                ├── quickprice.dll      (服务端模组)
                ├── mod.json            (服务端配置)
                └── config.json         (服务端配置)
```

## 🔧 编译步骤

### 1. 编译项目

```bash
# 编译客户端项目 (Release 配置)
dotnet build "D:\C#\QuickPrice\Sources\Client\QuickPrice.csproj" -c Release

# 编译服务端项目 (Release 配置)
dotnet build "D:\C#\QuickPrice\Sources\Server\QuickPrice.Server.csproj" -c Release
```

### 2. 创建发布目录

```bash
# 创建目录结构
mkdir -p "D:/C#/QuickPrice/Release/QuickPrice-v{版本号}/BepInEx/plugins/QuickPrice"
mkdir -p "D:/C#/QuickPrice/Release/QuickPrice-v{版本号}/SPT/user/mods/QuickPrice"
```

### 3. 复制文件

```bash
# 复制客户端 DLL
cp "D:/C#/QuickPrice/Sources/Client/bin/Release/net471/QuickPrice.dll" \
   "D:/C#/QuickPrice/Release/QuickPrice-v{版本号}/BepInEx/plugins/QuickPrice/"

# 复制服务端文件
cp "D:/C#/QuickPrice/Sources/Server/bin/Release/quickprice.dll" \
   "D:/C#/QuickPrice/Sources/Server/bin/Release/mod.json" \
   "D:/C#/QuickPrice/Sources/Server/bin/Release/config.json" \
   "D:/C#/QuickPrice/Release/QuickPrice-v{版本号}/SPT/user/mods/QuickPrice/"
```

### 4. 创建 README.txt

将 `Release/QuickPrice-v1.0.0/README.txt` 作为模板，更新版本号后复制到新版本目录。

### 5. 打包

```bash
# 压缩为 ZIP 文件
cd "D:/C#/QuickPrice/Release"
zip -r "QuickPrice-v{版本号}.zip" "QuickPrice-v{版本号}/"
```

或使用 PowerShell：
```powershell
Compress-Archive -Path "D:\C#\QuickPrice\Release\QuickPrice-v{版本号}" `
                 -DestinationPath "D:\C#\QuickPrice\Release\QuickPrice-v{版本号}.zip"
```

## 📦 快速打包脚本示例

对于版本 v1.0.1：

```bash
# 设置版本号
VERSION="1.0.1"
RELEASE_DIR="D:/C#/QuickPrice/Release/QuickPrice-v${VERSION}"

# 创建目录
mkdir -p "${RELEASE_DIR}/BepInEx/plugins/QuickPrice"
mkdir -p "${RELEASE_DIR}/SPT/user/mods/QuickPrice"

# 复制文件
cp "D:/C#/QuickPrice/Sources/Client/bin/Release/net471/QuickPrice.dll" \
   "${RELEASE_DIR}/BepInEx/plugins/QuickPrice/"

cp "D:/C#/QuickPrice/Sources/Server/bin/Release/quickprice.dll" \
   "D:/C#/QuickPrice/Sources/Server/bin/Release/mod.json" \
   "D:/C#/QuickPrice/Sources/Server/bin/Release/config.json" \
   "${RELEASE_DIR}/SPT/user/mods/QuickPrice/"

# 创建 README (需要手动编辑版本号)
# cp README_TEMPLATE.txt "${RELEASE_DIR}/README.txt"

echo "打包完成: ${RELEASE_DIR}"
```

## ✅ 发布前检查清单

- [ ] 已更新 `Sources/Client/VERSION.txt` 中的版本号
- [ ] 已更新 `Sources/Server/mod.json` 中的版本号
- [ ] 已编译客户端项目（Release 配置）
- [ ] 已编译服务端项目（Release 配置）
- [ ] 已复制所有必需文件到发布目录
- [ ] 已创建并更新 README.txt（包含正确版本号）
- [ ] 已验证目录结构符合规范
- [ ] 已测试发布包在 SPT 环境中正常工作
- [ ] 已创建 ZIP 压缩包

## 📝 重要文件说明

### 客户端文件
- `QuickPrice.dll`: BepInEx 插件，处理游戏内 UI 显示和价格展示

### 服务端文件
- `quickprice.dll`: SPT 服务端模组，提供动态价格数据
- `mod.json`: SPT 模组元数据，定义模组基本信息和加载方式
- `config.json`: 服务端配置文件，包含价格计算参数

### 注意事项
- **不需要** package.json（这是开发依赖配置文件）
- mod.json 中的版本号需要与发布版本一致
- config.json 包含默认配置，用户可以修改

## 🚀 GitHub Release 发布

参考 `Release/GitHub_Release_步骤.txt` 文件进行 GitHub Release 发布。

主要步骤：
1. 创建并推送版本标签
2. 在 GitHub 上创建 Release
3. 上传编译好的 ZIP 包
4. 填写 Release 说明（功能特性、安装方法、已知问题等）

## 📂 文件位置参考

| 文件 | 源位置 | 目标位置 |
|------|--------|----------|
| QuickPrice.dll (客户端) | `Sources/Client/bin/Release/net471/` | `QuickPrice-v{版本}/BepInEx/plugins/QuickPrice/` |
| quickprice.dll (服务端) | `Sources/Server/bin/Release/` | `QuickPrice-v{版本}/SPT/user/mods/QuickPrice/` |
| mod.json | `Sources/Server/bin/Release/` | `QuickPrice-v{版本}/SPT/user/mods/QuickPrice/` |
| config.json | `Sources/Server/bin/Release/` | `QuickPrice-v{版本}/SPT/user/mods/QuickPrice/` |
| README.txt | 手动创建 | `QuickPrice-v{版本}/` |
