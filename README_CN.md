# QuickPrice - 快速价格查询

**SPT (单机塔科夫) 4.0.0 实时物品价格显示插件**

![版本](https://img.shields.io/badge/%E7%89%88%E6%9C%AC-1.0.0-blue)
![SPT](https://img.shields.io/badge/SPT-4.0.0-green)
![许可证](https://img.shields.io/badge/%E8%AE%B8%E5%8F%AF%E8%AF%81-MIT-green)

[English](README.md) | [中文文档](README_CN.md)

---

## 📖 简介

**QuickPrice（快速价格）** 是一个综合性的 SPT 模组，可以在物品栏的提示框中直接显示物品的实时价格。通过颜色编码的价格指示器和详细的市场信息，帮助你做出明智的拾取、出售或保留决策。

### ✨ 核心功能

- 💰 **实时价格显示** - 鼠标悬停即可查看跳蚤市场和商人价格
- 🎨 **颜色编码系统** - 基于物品价值的六级颜色分类
- 🔫 **武器配件定价** - 计算包含所有配件的总价值
- 🛡️ **护甲等级着色** - 可视化的护甲等级指示器（1-6级）
- 🎯 **子弹穿甲显示** - 按穿甲力进行颜色编码
- 📊 **单格价值** - 查看物品价值密度，优化拾取策略
- 🏪 **商人价格对比** - 对比跳蚤市场和商人回收价格
- ⚡ **性能优化** - 智能容器计算，可配置性能限制
- 🌐 **完整中文化** - 全中文界面和配置选项

---

## 🚀 安装说明

### 前置要求

- SPT (单机塔科夫) **4.0.0**
- BepInEx **5.4.22** 或更高版本（SPT 自带）

### 客户端安装（BepInEx 插件）

1. 从 [Releases](https://github.com/quickprice/quickprice-spt/releases) 下载最新版本
2. 将 `QuickPrice.dll` 解压到：
   ```
   SPT安装目录/BepInEx/plugins/QuickPrice/
   ```
3. 启动 SPT 即可使用！

### 服务端安装（可选 - 用于动态价格）

1. 将服务端模组解压到：
   ```
   SPT安装目录/user/mods/QuickPrice/
   ```
2. 重启 SPT 服务器
3. 在客户端配置中启用"使用动态价格"（按 F12）

---

## 🎮 使用方法

### 基本操作

- **按住 Ctrl** - 鼠标悬停在物品上时，按住 `左Ctrl` 或 `右Ctrl` 查看价格
  - 可在配置中关闭此选项，改为鼠标悬停直接显示价格

### 颜色编码系统

#### 基于价格的颜色（普通物品）
| 颜色 | 价格区间 | 说明 |
|------|----------|------|
| ⚪ 白色 | ≤ 5,000₽ | 普通物品 |
| 🟢 绿色 | 5,001 - 18,000₽ | 低价值 |
| 🔵 蓝色 | 18,001 - 35,000₽ | 中等价值 |
| 🟣 紫色 | 35,001 - 70,000₽ | 高价值 |
| 🟠 橙色 | 70,001 - 180,000₽ | 极高价值 |
| 🔴 红色 | > 180,000₽ | 超高价值 |

#### 基于穿甲的颜色（子弹和弹匣）
| 颜色 | 穿甲值 | 有效性 |
|------|--------|--------|
| ⚪ 白色 | < 15 | 低穿甲 |
| 🟢 绿色 | 15 - 24 | 轻型护甲 |
| 🔵 蓝色 | 25 - 34 | 中型护甲 |
| 🟣 紫色 | 35 - 44 | 重型护甲 |
| 🟠 橙色 | 45 - 54 | 5级护甲 |
| 🔴 红色 | ≥ 55 | 6级护甲 |

#### 护甲等级颜色
| 颜色 | 护甲等级 | 防护等级 |
|------|----------|----------|
| ⚫ 灰色 | 1级 | 最低防护 |
| 🟢 绿色 | 2级 | 轻型防护 |
| 🔵 蓝色 | 3级 | 中型防护 |
| 🟣 紫色 | 4级 | 重型防护 |
| 🟠 橙色 | 5级 | 极重防护 |
| 🔴 红色 | 6级 | 最高防护 |

### 配置设置

游戏内按 **F12** 打开 BepInEx 配置管理器，可自定义：

- 切换价格显示（需要 Ctrl 或始终显示）
- 调整每个等级的颜色阈值
- 启用/禁用特定功能
- 大容器性能调优
- 缓存模式选择

---

## ⚙️ 配置选项

### 1. 主要设置
- **启用插件** - 总开关
- **显示跳蚤市场价格** - 显示跳蚤市场价值
- **显示每格价格** - 计算价值密度
- **显示武器配件价格** - 包含配件价值
- **按住Ctrl键才显示** - 按住 Ctrl 才显示价格（默认：启用）
- **提示框延迟（秒）** - 悬停后多久显示价格（0-2秒）

### 2. 显示设置
- **启用颜色编码** - 根据价值/穿甲给物品着色
- **最佳价格加粗** - 突出显示最高价格
- **子弹按穿甲等级着色** - 子弹按穿甲力着色而非价格
- **物品名称着色** - 给提示框中的物品名称着色
- **启用护甲等级着色** - 根据防护等级给护甲着色
- **自动着色物品背景** - 给物品栏格子应用颜色（实验性功能）

#### 2.1 价格颜色阈值
- **阈值1 - 白色→绿色** - 默认：5,000₽
- **阈值2 - 绿色→蓝色** - 默认：18,000₽
- **阈值3 - 蓝色→紫色** - 默认：35,000₽
- **阈值4 - 紫色→橙色** - 默认：70,000₽
- **阈值5 - 橙色→红色** - 默认：180,000₽

#### 2.2 穿甲颜色阈值
- **阈值1 - 白色→绿色** - 默认：15
- **阈值2 - 绿色→蓝色** - 默认：25
- **阈值3 - 蓝色→紫色** - 默认：35
- **阈值4 - 紫色→橙色** - 默认：45
- **阈值5 - 橙色→红色** - 默认：55

#### 2.3 护甲等级设置
- **启用护甲等级着色** - 根据防弹等级（1-6级）自动着色
- **显示护甲等级文字** - 在提示框中显示防弹等级

#### 2.4 重置功能
- **重置阈值快捷键** - 按 F9 重置所有阈值为默认值

### 3. 性能设置
- **使用动态价格** - 获取实时跳蚤市场价格（较慢）
- **价格缓存模式** - 永久缓存 / 5分钟 / 10分钟 / 仅手动刷新

#### 3.1 容器性能优化
- **最大递归深度** - 容器嵌套计算的最大层数（默认：10）
- **最大计算物品数** - 单个容器最多计算多少个物品（默认：100）
- **跳过大容器计算** - 跳过物品数超过150的容器计算
- **大容器物品数阈值** - 大容器判定阈值（默认：150）

### 4. v2.0 新增功能
- **显示商人价格** - 显示最佳商人回收价格
- **显示跳蚤税费** - 计算上架费用和净利润
- **打开物品栏自动刷新** - 打开仓库时刷新价格

---

## 🛠️ 从源码构建

### 客户端（BepInEx 插件）

```bash
cd Sources/Client
dotnet build -c Release
```

输出：`bin/Release/net471/QuickPrice.dll`

### 服务端（SPT 模组）

```bash
cd Sources/Server
dotnet build -c Release
```

输出：`bin/Release/quickprice.dll`

### 依赖要求
- .NET Framework 4.7.1 SDK（客户端）
- .NET 9.0 SDK（服务端）
- SPT 4.0.0 程序集（参考 .csproj 中的路径）

---

## 📊 性能优化

QuickPrice 包含智能性能优化：

- **智能容器计算** - 限制递归深度和物品数量
- **异步价格加载** - 非阻塞的后台更新
- **高效缓存** - 可配置的缓存过期时间
- **大容器跳过** - 避免150+物品的大型物品箱卡顿

默认限制（推荐）：
- 最大递归深度：**10 层**
- 单容器最大物品数：**100 个**
- 大容器阈值：**150 个**

---

## 🤝 贡献

欢迎贡献代码！请随时提交 Issues 和 Pull Requests。

### 开发指南
- 遵循现有代码风格
- 在 SPT 4.0.0 上充分测试
- 为新功能更新文档
- 保持中文本地化

---

## 📝 更新日志

### 版本 1.0.0 (2025-10-21)
- 首次发布
- 全新项目结构重写
- 完整支持 SPT 4.0.0
- 大容器性能优化
- 六级颜色编码系统
- 护甲等级检测和着色
- 商人价格对比
- 可配置的缓存模式
- 全中文本地化配置

---

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件

---

## 🙏 致谢

- SPT-AKI 开发团队提供的出色 SPT 平台
- BepInEx 团队提供的模组框架
- 所有贡献者和测试者

---

## 📞 支持

- **问题反馈**: [GitHub Issues](https://github.com/quickprice/quickprice-spt/issues)
- **讨论交流**: [GitHub Discussions](https://github.com/quickprice/quickprice-spt/discussions)

---

**用 ❤️ 为 SPT 社区打造**
